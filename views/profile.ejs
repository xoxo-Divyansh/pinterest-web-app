<% include ./partials/header.ejs %>
<div class="profile w-full min-h-screen bg-zinc-800 text-white ">
  <form id="uploadform" hidden class=" hidden w-full h-screen flex items-center justify-center" action="/fileupload" method="post" enctype="multipart/form-data">
    <input type="file" name="image">
  </form>
  <div class="profdets flex flex-col items-center justify-top pt-5 h-full gap-3 leading-none courser-pointer">
    <div class="relative">
      <span id="uploadicon" class="w-10 h-10 absolute bottom-0 right-0 rounded-full flex items-center justify-center bg-zinc-200">
        <i class="text-zinc-900 ri-pencil-line"></i></span>
      <div class="w-30 h-30 bg-zinc-200 rounded-full ">
        <img class="w-full h-full object-cover rounded-full overflow-hidden" src="/images/uploads/<%= user.profileImage %>" alt="loofi-profile">
      </div>
    </div>
    <div>
      <h1 class="block text-sm  mt-2"><span class="">@</span><%= user.username %></h1>
      <h3 class="block text-xl font-bold mb-2"><%= user.fullname %></h3>
      <a href="/edit" class="inline-block px-7 py-2 bg-zinc-700 text-sm font-semibold rounded-full ">Edit</a>
      <a class="inline-block bg-red-700 text-sm font-semibold px-3 py-2 rounded-lg" href='/add'>
        Add New Post
      </a>
    </div>
    <h3 class="text-2xl text-gray-200 font-bold mt-5 underline ">Uploaded Posts !</h3>
  </div>

  <div class="cards flex flex-wrap gap-10 px-20 mt-10">
    <% user.posts.forEach((post, index) => { %>
    <% if (post.image) { %>
    <div class="card w-65 bg-zinc-400 rounded-md shadow-md overflow-hidden">
      <div class="h-45 bg-zinc-200">
        <img class="w-full h-full object-cover" src="/images/uploads/<%= post.image %>" alt="Post <%= index + 1 %>" />
      </div>
      <div class="p-2 bg-zinc-900">
        <h3 class="text-md font-semibold text-gray-200">Uploaded Pin <%= index + 1 %></h3>
        <p class="text-sm text-gray-500 underline">
          <span class="font-semibold text-yellow-500 no-underline inline-block">Posted on:</span>
          <%= new Date(post.date).toLocaleString('en-IN', {
              weekday: 'short',
              year: 'numeric',
              month: 'short',
              day: '2-digit',
              hour: '2-digit',
            }) || 'Unknown Date' %>
        </p>

        <% if (post.description) { %>
        <p class="text-sm text-gray-100">
          <span class="font-semibold text-yellow-500">Disc:</span> <%= post.description %>
        </p>
        <% } %>
      </div>
    </div>
    <% } %>
    <% }) %>
  </div>


</div>

<script>
  document.querySelector("#uploadicon").addEventListener("click", () => {
    document.querySelector("#uploadform input").click();
  })
  document.querySelector('#uploadform input').addEventListener('change', () => {
    document.querySelector('#uploadform').submit();
  })
</script>
<% include ./partials/footer.ejs %>